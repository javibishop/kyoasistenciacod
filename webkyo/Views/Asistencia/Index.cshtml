@model IEnumerable<Kyo.Entidades.Alumno>

@{
    ViewBag.Title = "Asistencia de Alumnos";
}

<div class="page-header">
    <h3>@ViewBag.Title</h3>
</div>

@Html.AntiForgeryToken()
<div class="pull-right">
    <a href="" onclick="obtenerIds()" class="btn btn-info">
        Marcar Asistencia
        <span class="glyphicon glyphicon glyphicon-ok" aria-hidden="true"></span>
    </a>
    </div>
    <div class="col-md-12 table-responsive">
        <table id="mytable" class="table table-bordred table-striped">
            <thead>
                <tr>

                    <th><input type="checkbox" class="checkthis" /></th>
                    <th hidden="hidden"></th>
                    <th>
                        @Html.DisplayNameFor(model => model.Nombre)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Apellido)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Telefono)
                    </th>
                    <th style="width:5px;"></th>
                    <th style="width:5px;"></th>
                    <th style="width:5px;"></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td hidden="hidden">
                            @Html.DisplayFor(modelItem => item.Id, new { htmlAttributes = new { @name = "Id" } })
                        </td>
                        <td>
                            <input type="checkbox" class="checkthis" />
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Nombre)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Apellido)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Telefono)
                        </td>
                        <td><p data-placement="top" data-toggle="tooltip" title="Details"><a class="btn btn-success btn-xs" href="@Url.Action("Details", "Asistencia", new { id = item.Id })"><span class="glyphicon glyphicon-search"></span></a></p></td>
                        <td><p data-placement="top" data-toggle="tooltip" title="Edit"><a class="btn btn-primary btn-xs" href="@Url.Action("Edit", "Asistencia", new { id = item.Id })"><span class="glyphicon glyphicon-pencil"></span></a></p></td>
                        <td><p data-placement="top" data-toggle="tooltip" title="Delete"><button class="btn btn-danger btn-xs" data-title="Delete" href="@Url.Action("Delete", "Asistencia", new { id = item.Id })"><span class="glyphicon glyphicon-trash"></span></button></p></td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
    <script>
        function obtenerIds() {
            var idAs = [];
            $('#mytable tr').each(function (i, row) {
                $("#mytable tr:has(:checkbox:checked) td:nth-child(" + i + ")").each(function () {
                    idAs.push(parseInt($(this).text()));
                });
            });

            var token = $('[name=__RequestVerificationToken]').val();
            var id = JSON.stringify(idAs);
            if (idAs.length > 0) {
                $.ajax({
                    url: '@Url.Action("GuardarAsistencia", "Asistencia")',
                    headers: { '__RequestVerificationToken': token },
                    data: id,
                    type: "POST",
                    dataType: 'json',
                    contentType: "application/json; charset=utf-8"
                }).done(function () {
                    alert('Added');
                });
            }
        }

    </script>
